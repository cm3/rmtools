<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>researchmap JSONL å¤‰æ›ãƒ–ãƒƒã‚¯ãƒãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆç”Ÿæˆ</title>
  <style>
    body {
      font-family: sans-serif;
      line-height: 1.6;
      margin: 2em;
    }
    label, input, button {
      font-size: 1em;
    }
    input {
      width: 200px;
      margin-right: 1em;
    }
    code {
      background: #f0f0f0;
      padding: 0.2em 0.4em;
      border-radius: 4px;
    }
    #bookmarklet-link {
      display: inline-block;
      margin-top: 1em;
      padding: 0.5em 1em;
      background: #007acc;
      color: white;
      text-decoration: none;
      border-radius: 4px;
    }
    #bookmarklet-link:hover {
      background: #005f99;
    }
  </style>
</head>
<body>
  <h1>researchmap â†’ JSONL å¤‰æ›ãƒ–ãƒƒã‚¯ãƒãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆ</h1>
  <p>
    å…±è‘—è€…ã®æ¥­ç¸¾ã‚’è‡ªåˆ†ã®æ¥­ç¸¾ã¨ã—ã¦ã‚³ãƒ”ãƒ¼ã™ã‚‹æ–¹æ³•ã§ã™ã€‚
  </p>

  <h2>ã‚¹ãƒ†ãƒƒãƒ—</h2>
  <ol>
    <li><strong>researchmapä¼šå“¡ID</strong> ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ï¼ˆä¾‹: <code>B000000079</code>ï¼‰</li>
    <li>ã€Œãƒ–ãƒƒã‚¯ãƒãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã‚’ç”Ÿæˆã€ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ãã ã•ã„</li>
    <li>ç”Ÿæˆã•ã‚ŒãŸãƒªãƒ³ã‚¯ã‚’ãƒ–ãƒƒã‚¯ãƒãƒ¼ã‚¯ãƒãƒ¼ã«ãƒ‰ãƒ©ãƒƒã‚°ã—ã¦ãã ã•ã„</li>
    <li>ã‚³ãƒ”ãƒ¼ã—ãŸã„å…±è‘—è€…ã®æ¥­ç¸¾ã‚’ researchmap ã§è¡¨ç¤ºã—ã¦ãã ã•ã„</li>
    <li>ã•ãã»ã©ãƒ–ãƒƒã‚¯ãƒãƒ¼ã‚¯ã«è¿½åŠ ã—ãŸãƒ–ãƒƒã‚¯ãƒãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨ãƒ•ã‚¡ã‚¤ãƒ«ãŒãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã•ã‚Œã¾ã™</li>
    <li>è‡ªåˆ†ã® researchmap ãƒšãƒ¼ã‚¸ã®ã‚¤ãƒ³ãƒãƒ¼ãƒˆæ©Ÿèƒ½ã‹ã‚‰ã‚¤ãƒ³ãƒãƒ¼ãƒˆã—ã¦ãã ã•ã„</li>
  </ol>

  <label for="userId">researchmapä¼šå“¡ID:</label>
  <input type="text" id="userId" placeholder="B0000000XX">
  <button onclick="generateBookmarklet()">ãƒ–ãƒƒã‚¯ãƒãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã‚’ç”Ÿæˆ</button>

  <p id="output"></p>

  <script>
    function generateBookmarklet() {
      const userId = document.getElementById('userId').value.trim();
      if (!userId) {
        alert('researchmapä¼šå“¡ID ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚');
        return;
      }

      const code = `(async()=>{const USER_ID="${userId}";function convertToApiUrl(url){return url.replace("researchmap.jp/","api.researchmap.jp/");}function transformJsonObject(original){return{"insert":{"type":original["@type"]||"unknown_type","user_id":USER_ID},"merge":Object.fromEntries(Object.entries(original).filter(([k])=>!["@context","@type","@id"].includes(k)))}}const url=window.location.href;if(!url.includes("researchmap.jp/")){alert("researchmapã®ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ãƒšãƒ¼ã‚¸ã§å®Ÿè¡Œã—ã¦ãã ã•ã„");return;}const apiUrl=convertToApiUrl(url);try{const res=await fetch(apiUrl);if(!res.ok)throw new Error("HTTP error");const data=await res.json();const converted=transformJsonObject(data);const jsonlLine=JSON.stringify(converted);const blob=new Blob([jsonlLine+"\\n"],{type:"application/json"});const a=document.createElement("a");a.href=URL.createObjectURL(blob);a.download="converted.jsonl";a.click();}catch(e){alert("å¤±æ•—: "+e);}})();`;

      const link = document.createElement('a');
      link.id = 'bookmarklet-link';
      link.href = 'javascript:' + encodeURIComponent(code);
      link.textContent = 'ğŸ“¥ JSONLãƒ–ãƒƒã‚¯ãƒãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆï¼ˆãƒ‰ãƒ©ãƒƒã‚°ã—ã¦ç™»éŒ²ï¼‰';

      const output = document.getElementById('output');
      output.innerHTML = '';
      output.appendChild(link);
    }
  </script>
</body>
</html>
